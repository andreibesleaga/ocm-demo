"use strict";
// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.endpoints = void 0;
exports.query = query;
const list_poi_1 = __importDefault(require("./poi/list-poi.js"));
const retrieve_referencedata_1 = __importDefault(require("./referencedata/retrieve-referencedata.js"));
const authenticate_profile_1 = __importDefault(require("./profile/authenticate-profile.js"));
const submit_comment_1 = __importDefault(require("./comment/submit-comment.js"));
const create_mediaitem_1 = __importDefault(require("./mediaitem/create-mediaitem.js"));
const retrieve_openapi_1 = __importDefault(require("./openapi/retrieve-openapi.js"));
exports.endpoints = [];
function addEndpoint(endpoint) {
    exports.endpoints.push(endpoint);
}
addEndpoint(list_poi_1.default);
addEndpoint(retrieve_referencedata_1.default);
addEndpoint(authenticate_profile_1.default);
addEndpoint(submit_comment_1.default);
addEndpoint(create_mediaitem_1.default);
addEndpoint(retrieve_openapi_1.default);
function query(filters, endpoints) {
    const allExcludes = filters.length > 0 && filters.every((filter) => filter.op === 'exclude');
    const unmatchedFilters = new Set(filters);
    const filtered = endpoints.filter((endpoint) => {
        let included = false || allExcludes;
        for (const filter of filters) {
            if (match(filter, endpoint)) {
                unmatchedFilters.delete(filter);
                included = filter.op === 'include';
            }
        }
        return included;
    });
    // Check if any filters didn't match
    const unmatched = Array.from(unmatchedFilters).filter((f) => f.type === 'tool' || f.type === 'resource');
    if (unmatched.length > 0) {
        throw new Error(`The following filters did not match any endpoints: ${unmatched
            .map((f) => `${f.type}=${f.value}`)
            .join(', ')}`);
    }
    return filtered;
}
function match({ type, value }, endpoint) {
    switch (type) {
        case 'resource': {
            const regexStr = '^' + normalizeResource(value).replace(/\*/g, '.*') + '$';
            const regex = new RegExp(regexStr);
            return regex.test(normalizeResource(endpoint.metadata.resource));
        }
        case 'operation':
            return endpoint.metadata.operation === value;
        case 'tag':
            return endpoint.metadata.tags.includes(value);
        case 'tool':
            return endpoint.tool.name === value;
    }
}
function normalizeResource(resource) {
    return resource.toLowerCase().replace(/[^a-z.*\-_]*/g, '');
}
//# sourceMappingURL=index.js.map